<!-- views/pamonitoring.ejs.ejs -->

<!DOCTYPE html>
<html lang="en">
<head>
    <title>Test sensor</title>
    <% include ../partials/head %>

    <script src="angular/angular.js"></script>
    <script src="angular-google-chart/ng-google-chart.js"></script>

    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>

</head>

<script type="text/javascript">
  var angularApp = angular.module('myApp', []);
  angularApp.controller('getSensorCtrl', function ($scope, $http) {

    //-----------------------------------------------
    $scope.mSensorList = [];

    $scope.getSensorList = function () {
      console.log("getSensorList!");
      $http({
        method: 'GET',
        url: 'getallsensorparams'
      }).then(function (response) {
        $scope.mSensorList = response.data;
        console.log(">>>>>  mSensorList: " + JSON.stringify($scope.mSensorList));
      }, function (error) {
        console.log("getSensorList ERROR: " + error);
      });
    };
    $scope.getSensorList();  //initial data load


    $scope.getLatestMeasurementForSensorID = function () {
      console.log("getLatestMeasurementForSensorID");
      $http({
        method: 'GET',
        url: 'getlatestsensormeasurement/' + $scope.selectedSensor.sensor_id
      }).then(function (response) {
        $scope.selectedSensor = response.data;
      }, function (error) {
        console.log("getlatestsensormeasurement ERROR: " + error);
      });
    };

    $(function() {
      $('.selectpicker').on('change', function(){
        var selected = $(this).find("option:selected.sensor_name");
        alert(selected);
      });
    });

    <!-- ........ GAUGE VIEW........ -->
    //-----------------------------------------------------------------------
    google.charts.load('current', {'packages': ['gauge']});
    google.charts.setOnLoadCallback(drawChart);

    function drawChart() {
      var data = google.visualization.arrayToDataTable([
        ['Label', 'Value'],
        ['sensor 1', 80],
        ['sensor 2', 55],
      ]);

      var options = {
        width: 400, height: 120,
        greenFrom: 50, greenTo: 80,
        yellowFrom: 80, yellowTo: 90,
        redFrom: 90, redTo: 100,
        minorTicks: 5
      };

      var chart = new google.visualization.Gauge(document.getElementById('gauge_div'));
      let sen1val = $scope.selectedSensor.sensor_value;
      data.setValue(0, 1, sen1val);
      chart.draw(data, options);

    }
  });
</script>

<body class="container" ng-app="myApp" ng-controller="getSensorCtrl">
<header>
    <% include ../partials/header %>
</header>

<main>
    <div class="row">
        <div class="container" class="col-sm-12">
            <div class="panel panel-info class">
                <div class="panel-heading">LATEST SENSOR MEASUREMENTS</div>
                <div class="panel-body">
                    <div>
                        <div class="row">
                            <div class="col-sm-4">
                                <select class="selectpicker"
                                        ng-model="selectedSensor"
                                        ng-options="sensor.sensor_name for sensor in mSensorList">
                                </select>
                            </div>


                            <div class="col-sm-8">
                                <h4>Analog temp.</h4>
                                <div id="gauge_div" style="width: 400px; height: 120px;"></div>
                            </div>
                        </div>

                        <table>
                            <tr>
                                <th>ID</th>
                                <th>TYPE</th>
                                <th>MID</th>
                                <th>NAME</th>
                            </tr>
                            <tr>
                                <td>{{selectedSensor.id}}</td>
                                <td>{{selectedSensor.sensor_type}}</td>
                                <td>{{selectedSensor.sensor_mid}}</td>
                                <td>{{selectedSensor.sensor_name}}</td>
                            </tr>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</main>

<footer class="container-fluid bg-4 text-center">
    <% include ../partials/footer %>
</footer>

</body>
</html>
